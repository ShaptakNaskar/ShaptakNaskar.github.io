<!DOCTYPE html>
<html>
  <head>
    <title>Number Converter</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        padding: 25px;
        background-color: white;
        color: black;
        font-size: 20px;
        font-family: Arial, sans-serif;
      }

      .dark-mode {
        background-color: black;
        color: #d7d7d7;
      }

      input {
        margin-bottom: 10px;
        font-size: 18px;
      }

      label {
        display: block;
        margin-top: 10px;
      }

      #inline-info-box {
        display: none;
        margin-top: 5px;
                background-color: #ffffff;
               font-size: 16px;
      }

      .dark-mode #inline-info-box {
        background-color: #000000;
        color: #ffffff;
        border-left-color: #4eafff;
      }

      #inline-info-box span {
        display: inline-block;
        margin-right: 8px;
      }

      .bit-options label {
        margin-right: 10px;
        font-size: 16px;
      }

      button {
        font-size: 18px;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Number Converter</h1>
	<p>
      <strong class="important"><a href="index.html">Click here to go back to the index Page</strong></a>
      </p>
    <p>Convert numbers between Decimal, Binary, Hexadecimal, and Octal.</p>

    <form>
      <label for="decimal">Decimal:</label>
      <input type="text" id="decimal" name="decimal" />

      <label for="binary">Binary:</label>
      <input type="text" id="binary" name="binary" />
      <div id="inline-info-box">
        <div>The above shown value is in 2's complement</div>
        <div class="bit-options">
          <span>You can additionally choose a bit size below:</span>
          <label><input type="radio" name="bitLength" value="8" id="bit8" /> 8-bit</label>
          <label><input type="radio" name="bitLength" value="16" id="bit16" /> 16-bit</label>
          <label><input type="radio" name="bitLength" value="32" id="bit32" checked /> 32-bit</label>
          <label><input type="radio" name="bitLength" value="64" id="bit64" /> 64-bit</label>
        </div>
      </div>

      <label for="hexadecimal">Hexadecimal:</label>
      <input type="text" id="hexadecimal" name="hexadecimal" />

      <label for="octal">Octal:</label>
      <input type="text" id="octal" name="octal" />

      <button type="button" id="clear">CLEAR</button>
    </form>

    <button onclick="darkmode()">Toggle dark mode</button>

    <script>
      function darkmode() {
    document.body.classList.toggle("dark-mode");
  }

  // Auto-enable dark mode if user prefers dark theme
  window.addEventListener('load', function () {
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      darkmode();
    }
  });

      const decimalInput = document.getElementById("decimal");
      const binaryInput = document.getElementById("binary");
      const hexadecimalInput = document.getElementById("hexadecimal");
      const octalInput = document.getElementById("octal");
      const clearButton = document.getElementById("clear");
      const infoBox = document.getElementById("inline-info-box");

      const bitRadios = {
        8: document.getElementById("bit8"),
        16: document.getElementById("bit16"),
        32: document.getElementById("bit32"),
        64: document.getElementById("bit64"),
      };

      let currentNegativeValue = null;

      clearButton.addEventListener("click", function () {
        decimalInput.value = "";
        binaryInput.value = "";
        hexadecimalInput.value = "";
        octalInput.value = "";
        infoBox.style.display = "none";
        currentNegativeValue = null;
      });

      function toTwosComplement(num, bits) {
        const maxNeg = -1 * Math.pow(2, bits - 1);
        const maxPos = Math.pow(2, bits - 1) - 1;
        if (num < maxNeg || num > maxPos) return null;
        return (num >>> 0).toString(2).padStart(bits, "0").slice(-bits);
      }

      function updateBitOptions(num) {
        infoBox.style.display = num < 0 ? "block" : "none";
        currentNegativeValue = num < 0 ? num : null;

        Object.keys(bitRadios).forEach((bit) => {
          const parsedBit = parseInt(bit);
          const fits = num >= -Math.pow(2, parsedBit - 1) && num < Math.pow(2, parsedBit - 1);
          bitRadios[bit].disabled = !fits;
        });
      }

      function updateBinaryField(num) {
        if (num >= 0) {
          binaryInput.value = num.toString(2);
          infoBox.style.display = "none";
        } else {
          updateBitOptions(num);
          const selectedBit = parseInt(
            document.querySelector('input[name="bitLength"]:checked').value
          );
          const twos = toTwosComplement(num, selectedBit);
          binaryInput.value = twos ?? "Too large for selected bit";
        }
      }

      function updateAllFromDecimal(value) {
        updateBinaryField(value);
        hexadecimalInput.value = value.toString(16).toUpperCase();
        octalInput.value = value.toString(8);
      }

      function safeParse(value, base, regex) {
        if (regex.test(value)) {
          const num = parseInt(value, base);
          return isNaN(num) ? null : num;
        }
        return null;
      }

      decimalInput.addEventListener("input", function () {
        const value = parseInt(this.value, 10);
        if (!isNaN(value)) {
          updateAllFromDecimal(value);
        } else {
          binaryInput.value = hexadecimalInput.value = octalInput.value = "Invalid";
          infoBox.style.display = "none";
        }
      });

      binaryInput.addEventListener("input", function () {
        const value = this.value;
        const parsed = safeParse(value, 2, /^-?[01]+$/);
        if (parsed !== null) {
          decimalInput.value = parsed;
          hexadecimalInput.value = parsed.toString(16).toUpperCase();
          octalInput.value = parsed.toString(8);
          updateBinaryField(parsed);
        } else {
          decimalInput.value = hexadecimalInput.value = octalInput.value = "Invalid";
          infoBox.style.display = "none";
        }
      });

      hexadecimalInput.addEventListener("input", function () {
        const value = this.value;
        const parsed = safeParse(value, 16, /^-?[0-9a-fA-F]+$/);
        if (parsed !== null) {
          decimalInput.value = parsed;
          octalInput.value = parsed.toString(8);
          updateBinaryField(parsed);
        } else {
          decimalInput.value = binaryInput.value = octalInput.value = "Invalid";
          infoBox.style.display = "none";
        }
      });

      octalInput.addEventListener("input", function () {
        const value = this.value;
        const parsed = safeParse(value, 8, /^-?[0-7]+$/);
        if (parsed !== null) {
          decimalInput.value = parsed;
          hexadecimalInput.value = parsed.toString(16).toUpperCase();
          updateBinaryField(parsed);
        } else {
          decimalInput.value = binaryInput.value = hexadecimalInput.value = "Invalid";
          infoBox.style.display = "none";
        }
      });

      // Handle bit option change
      document.querySelectorAll('input[name="bitLength"]').forEach((radio) => {
        radio.addEventListener("change", () => {
          if (currentNegativeValue !== null) {
            updateBinaryField(currentNegativeValue);
          }
        });
      });
    </script>
  </body>
</html>
